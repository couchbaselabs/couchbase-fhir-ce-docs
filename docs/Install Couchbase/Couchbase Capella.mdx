---
sidebar_position: 3
title: "Couchbase Capella"
---

# Couchbase Capella Setup

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import ImgSingle1 from "@site/static/img/install/cb-capella-single-1.png";
import ImgSingle2 from "@site/static/img/install/cb-capella-single-2.png";
import ImgCustom1 from "@site/static/img/install/cb-capella-custom-1.png";
import ImgCustom2 from "@site/static/img/install/cb-capella-custom-2.png";
import ImgIp from "@site/static/img/install/cb-capella-ip.png";
import ImgAccess from "@site/static/img/install/cb-capella-access.png";
import ImgBucket from "@site/static/img/install/capella-bucket.png";

:::info What is Capella?
**Couchbase Capella** is the fully-managed Database-as-a-Service (DBaaS) offering from Couchbase. It provides enterprise-grade Couchbase clusters in the cloud without the operational overhead.
:::

Capella offers two deployment options for FHIR CE. Choose based on your needs:

<Tabs>
<TabItem value="single" label="Single Node" default>

## Single Node Capella Setup

Perfect for development, testing, and small production workloads.

### Step 1: Create New Capella Cluster

<img src={ImgSingle1} alt="Create Single Node Capella Cluster" />

:::tip Cluster Naming
You can name the cluster anything meaningful (e.g., "fhir-dev-cluster", "hospital-cluster")
:::

### Step 2: Configure Services

<img src={ImgSingle2} alt="Configure Single Node Services" />

**Service Configuration:**

1. **Adjust Compute** - Select appropriate instance size for your workload
2. **Add Search Service** - Required for FHIR full-text search capabilities

:::success Required Services
Your cluster should now have **4 essential services**:

- **Data** - Document storage
- **Query** - N1QL query processing
- **Index** - Primary indexes
- **Search** - Full-text search (FTS)
  :::

</TabItem>
<TabItem value="custom" label="Custom Configuration (Recommended)">

## Custom Capella Setup

For advanced users who need specific configurations.

### Step 1: Choose Custom Deployment

<img src={ImgCustom1} alt="Create Custom Capella Cluster" />

:::info Custom Setup

- Choose **Custom** deployment option
- Name your cluster appropriately
- This gives you full control over node configuration
  :::

### Step 2: Configure Single Node

<img src={ImgCustom2} alt="Configure Custom Services" />

**Custom Configuration Steps:**

1. **Delete extra nodes** - Keep only 1 node for single-node setup
2. **Adjust Compute** - Select instance type based on workload
3. **Add Search Service** - Essential for FHIR functionality

:::warning Single Node Setup
Make sure to **delete all nodes except 1** to create a true single-node deployment suitable for FHIR CE.
:::

</TabItem>
</Tabs>

## Network Security Configuration

### Add Allowed IP Addresses

<img src={ImgIp} alt="Configure Allowed IP Addresses" />

Configure network access for your FHIR server:

:::info Network Access Control
This setting controls **client access** to your Capella cluster. You have two options:
:::

<Tabs>
<TabItem value="specific" label="Specific IP (Recommended)" default>

**Add FHIR Server IP:**

- Add the specific IP address of your FHIR server
- More secure approach for production environments
- Requires knowing the exact IP where FHIR CE will run

</TabItem>
<TabItem value="anywhere" label="Allow From Anywhere">

**Allow access from anywhere:**

- Use `0.0.0.0/0` for development/testing
- **Not recommended for production** due to security implications
- Convenient for dynamic IP environments

</TabItem>
</Tabs>

## Database Access Configuration

### Create Cluster Access Credentials

<img src={ImgAccess} alt="Configure Database Access Credentials" />

Create database credentials for FHIR CE to access your Capella cluster:

:::warning Important - Save These Credentials
**Note down the username and password** - you will need these in your **FHIR CE `config.yaml`** file!
:::

**Access Configuration:**

- **Username**: Create a meaningful username (e.g., "fhir-service")
- **Password**: Generate a strong password
- **Bucket Access**: Choose **All Buckets**
- **Scope Access**: Choose **All Scopes**
- **Collection Access**: Choose **All Collections**
- **Permissions**: Grant **Read/Write** access

:::tip FHIR Requirements
FHIR CE requires **full read/write access** to all buckets, scopes, and collections to properly manage FHIR resources and multi-tenancy.
:::

## FHIR Tenant Configuration

### Create the FHIR Bucket

<img src={ImgBucket} alt="Create FHIR Bucket" />

Configure your FHIR bucket:

**Bucket Configuration Guidelines:**

- **Bucket Name**: fhir _this is fixed_
- **Memory Quota**: Allocate based on your expected data volume
- **Bucket Type**: Keep as **Couchbase** (default)
- **Replicas**: Capella handles replication automatically
- **Compression**: Enabled by default for better storage efficiency

<Tabs>
<TabItem value="development" label="ðŸ§ª Development Setup" default>

**Recommended Configuration:**

```yaml
Bucket Name: fhir
Memory Quota: 1 GB
Durability: Majority
Compression: Enabled
```

Perfect for development, testing, and proof-of-concept deployments.

</TabItem>
<TabItem value="production" label="Production Setup">

**Recommended Configuration:**

```yaml
Bucket Name: fhir
Memory Quota: 4 GB or higher
Durability: Majority
Compression: Enabled
```

Suitable for production healthcare environments with high availability requirements.

</TabItem>
</Tabs>

## Connection Information

:::info Connection String for FHIR CE
When configuring FHIR CE, use your EC2 instance's connection details (example):

```yaml
connection:
  connectionString: "couchbases://cb.xxx-xxx.cloud.couchbase.com"
  username: "dbaas"
  password: "password"
  serverType: "Capella"
  sslEnabled: true
```

:::

:::success Next Steps
**Congratulations!** Your Capella cluster is ready. Now you can install and configure FHIR CE to connect to this managed Couchbase instance.
:::
