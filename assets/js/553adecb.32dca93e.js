"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9143],{1072:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>a,frontMatter:()=>l,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"API/history-everything","title":"History and Everything","description":"Endpoints Implemented","source":"@site/docs/API/history-everything.mdx","sourceDirName":"API","slug":"/API/history-everything","permalink":"/docs/API/history-everything","draft":false,"unlisted":false,"editUrl":"https://github.com/couchbaselabs/couchbase-fhir-ce-docs/tree/master/docs/API/history-everything.mdx","tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14,"title":"History and Everything"},"sidebar":"tutorialSidebar","previous":{"title":"Search Pagination","permalink":"/docs/API/search-pagination"}}');var t=i(4848),s=i(8453);const l={sidebar_position:14,title:"History and Everything"},c="History",d={},o=[{value:"Endpoints Implemented",id:"endpoints-implemented",level:2},{value:"1. Get Specific Version (vread)",id:"1-get-specific-version-vread",level:3},{value:"Example",id:"example",level:4},{value:"Implementation",id:"implementation",level:4},{value:"2. Get Complete History",id:"2-get-complete-history",level:3},{value:"Example",id:"example-1",level:4},{value:"Overview",id:"overview",level:2},{value:"Endpoints",id:"endpoints",level:2},{value:"Instance-Level Operation (Supported)",id:"instance-level-operation-supported",level:3},{value:"Type-Level Operation (Not Supported)",id:"type-level-operation-not-supported",level:3},{value:"Query Parameters",id:"query-parameters",level:2},{value:"Resource Types Included",id:"resource-types-included",level:2},{value:"Implementation Strategy",id:"implementation-strategy",level:2},{value:"1. Patient Validation",id:"1-patient-validation",level:3},{value:"2. Resource Search",id:"2-resource-search",level:3},{value:"3. Batch Retrieval",id:"3-batch-retrieval",level:3},{value:"4. Bundle Construction",id:"4-bundle-construction",level:3},{value:"Examples",id:"examples",level:2},{value:"1. Get Everything for a Patient",id:"1-get-everything-for-a-patient",level:3},{value:"Response",id:"response",level:3},{value:"2. Filter by Resource Type",id:"2-filter-by-resource-type",level:3},{value:"3. Filter by Date Range",id:"3-filter-by-date-range",level:3},{value:"4. Limit Results",id:"4-limit-results",level:3},{value:"5. Get Recent Updates",id:"5-get-recent-updates",level:3},{value:"Optimization Tips",id:"optimization-tips",level:3},{value:"Comparison with _include/_revinclude",id:"comparison-with-_include_revinclude",level:2},{value:"When to use $everything",id:"when-to-use-everything",level:3},{value:"When to use _revinclude",id:"when-to-use-_revinclude",level:3}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"history",children:"History"})}),"\n",(0,t.jsx)(n.h2,{id:"endpoints-implemented",children:"Endpoints Implemented"}),"\n",(0,t.jsx)(n.h3,{id:"1-get-specific-version-vread",children:"1. Get Specific Version (vread)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /fhir/{bucket}/{resourceType}/{id}/_history/{versionId}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"GET http://localhost:8080/fhir/acme/Patient/1234/_history/2\n"})}),"\n",(0,t.jsx)(n.h4,{id:"implementation",children:"Implementation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Direct KV GET from ",(0,t.jsx)(n.code,{children:"Versions"})," collection"]}),"\n",(0,t.jsxs)(n.li,{children:["Key format: ",(0,t.jsx)(n.code,{children:"Patient/1234/2"})]}),"\n",(0,t.jsx)(n.li,{children:"Fast, single KV operation"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-get-complete-history",children:"2. Get Complete History"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /fhir/{bucket}/{resourceType}/{id}/_history?_count={count}&_since={date}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"example-1",children:"Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"GET http://localhost:8080/fhir/acme/Patient/1234/_history\nGET http://localhost:8080/fhir/acme/Patient/1234/_history?_count=20\nGET http://localhost:8080/fhir/acme/Patient/1234/_history?_since=2025-01-01T00:00:00Z\n"})}),"\n",(0,t.jsx)(n.h1,{id:"everything",children:"Everything"}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"$everything"})," operation returns all resources related to a specific patient. This is a powerful FHIR operation that provides a comprehensive view of a patient's clinical data."]}),"\n",(0,t.jsx)(n.h2,{id:"endpoints",children:"Endpoints"}),"\n",(0,t.jsx)(n.h3,{id:"instance-level-operation-supported",children:"Instance-Level Operation (Supported)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /fhir/{bucket}/Patient/{id}/$everything\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Returns all resources for a specific patient."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"type-level-operation-not-supported",children:"Type-Level Operation (Not Supported)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /fhir/{bucket}/Patient/$everything\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["This is ",(0,t.jsx)(n.strong,{children:"NOT"})," supported. The operation requires a specific patient ID."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"query-parameters",children:"Query Parameters"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Example"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"start"})}),(0,t.jsx)(n.td,{children:"Date"}),(0,t.jsx)(n.td,{children:"Start date filter for clinical resources"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"?start=2023-01-01"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"end"})}),(0,t.jsx)(n.td,{children:"Date"}),(0,t.jsx)(n.td,{children:"End date filter for clinical resources"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"?end=2024-12-31"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"_type"})}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{children:"Comma-separated list of resource types to include"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"?_type=Observation,Condition"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"_since"})}),(0,t.jsx)(n.td,{children:"DateTime"}),(0,t.jsx)(n.td,{children:"Only resources updated after this instant"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"?_since=2024-01-01T00:00:00Z"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"_count"})}),(0,t.jsx)(n.td,{children:"Integer"}),(0,t.jsx)(n.td,{children:"Maximum number of resources to return (default: 50, max: 200)"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"?_count=100"})})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"resource-types-included",children:"Resource Types Included"}),"\n",(0,t.jsx)(n.p,{children:"The operation searches across the following resource types (in order of clinical relevance):"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Observation"})," - Lab results, vital signs, etc."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Condition"})," - Diagnoses, problems"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Encounter"})," - Visits, admissions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Procedure"})," - Surgical procedures, treatments"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"DiagnosticReport"})," - Lab reports, imaging reports"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"MedicationRequest"})," - Prescriptions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Immunization"})," - Vaccinations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ServiceRequest"})," - Orders, referrals"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"DocumentReference"})," - Clinical documents"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"General"})," - Other resources"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"implementation-strategy",children:"Implementation Strategy"}),"\n",(0,t.jsx)(n.h3,{id:"1-patient-validation",children:"1. Patient Validation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"KV Lookup"}),": Direct key-value retrieval of ",(0,t.jsx)(n.code,{children:"Patient/{id}"})," from the Patient collection"]}),"\n",(0,t.jsxs)(n.li,{children:["Returns ",(0,t.jsx)(n.code,{children:"404 Not Found"})," if the patient doesn't exist"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-resource-search",children:"2. Resource Search"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"FTS Queries"}),": For each resource type, execute FTS queries to find resources that reference the patient"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reference Fields"}),": Always searches BOTH ",(0,t.jsx)(n.code,{children:"patient.reference"})," OR ",(0,t.jsx)(n.code,{children:"subject.reference"})," for all resource types"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Filters"}),": Applies date range (",(0,t.jsx)(n.code,{children:"start"}),", ",(0,t.jsx)(n.code,{children:"end"}),"), update time (",(0,t.jsx)(n.code,{children:"_since"}),"), and resource type (",(0,t.jsx)(n.code,{children:"_type"}),") filters"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Sorting"}),": All results sorted by ",(0,t.jsx)(n.code,{children:"meta.lastUpdated"})," DESC (newest first)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-batch-retrieval",children:"3. Batch Retrieval"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Grouping"}),": Groups all matching keys by resource type"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"KV Operations"}),": Batch retrieves documents for each resource type (efficient!)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Ordering"}),": Returns resources in clinical relevance order"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"4-bundle-construction",children:"4. Bundle Construction"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Patient First"}),": The patient resource is always first in the bundle"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Search Mode"}),": Patient has ",(0,t.jsx)(n.code,{children:"mode=match"}),", all others have ",(0,t.jsx)(n.code,{children:"mode=include"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Count Limiting"}),": Respects the ",(0,t.jsx)(n.code,{children:"_count"})," parameter (default: 50, max: 1000)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.h3,{id:"1-get-everything-for-a-patient",children:"1. Get Everything for a Patient"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"GET http://localhost:8080/fhir/acme/Patient/1234/$everything\n"})}),"\n",(0,t.jsx)(n.h3,{id:"response",children:"Response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "resourceType": "Bundle",\n  "type": "searchset",\n  "total": 48,\n  "entry": [\n    {\n      "fullUrl": "http://localhost:8080/fhir/acme/Patient/1234",\n      "resource": {\n        "resourceType": "Patient",\n        "id": "1234",\n        "name": [{ "family": "Smith", "given": ["John"] }]\n      },\n      "search": { "mode": "match" }\n    },\n    {\n      "fullUrl": "http://localhost:8080/fhir/acme/Observation/5678",\n      "resource": {\n        "resourceType": "Observation",\n        "id": "5678",\n        "subject": { "reference": "Patient/1234" }\n      },\n      "search": { "mode": "include" }\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-filter-by-resource-type",children:"2. Filter by Resource Type"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"GET http://localhost:8080/fhir/acme/Patient/1234/$everything?_type=Observation,Condition\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Returns only Observations and Conditions."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-filter-by-date-range",children:"3. Filter by Date Range"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"GET http://localhost:8080/fhir/acme/Patient/1234/$everything?start=2024-01-01&end=2024-12-31\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Returns only resources with clinical dates in 2024."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"4-limit-results",children:"4. Limit Results"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"GET http://localhost:8080/fhir/acme/Patient/1234/$everything?_count=10\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Returns the patient + up to 9 related resources (10 total)."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"5-get-recent-updates",children:"5. Get Recent Updates"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"GET http://localhost:8080/fhir/acme/Patient/1234/$everything?_since=2024-10-01T00:00:00Z\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Returns only resources updated since October 1, 2024."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"optimization-tips",children:"Optimization Tips"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"_type"})," parameter to search only needed resource types"]}),"\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"_count"})," parameter to limit results"]}),"\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"_since"})," parameter for incremental updates"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"comparison-with-_include_revinclude",children:"Comparison with _include/_revinclude"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Feature"}),(0,t.jsx)(n.th,{children:"$everything"}),(0,t.jsx)(n.th,{children:"_revinclude"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Purpose"})}),(0,t.jsx)(n.td,{children:"Get ALL patient data"}),(0,t.jsx)(n.td,{children:"Get specific related resources"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Resource Types"})}),(0,t.jsx)(n.td,{children:"10+ types automatically"}),(0,t.jsx)(n.td,{children:"1 type per parameter"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Query"})}),(0,t.jsx)(n.td,{children:"Single operation"}),(0,t.jsx)(n.td,{children:"Multiple includes needed"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Use Case"})}),(0,t.jsx)(n.td,{children:"Complete patient view"}),(0,t.jsx)(n.td,{children:"Specific relationships"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Performance"})}),(0,t.jsx)(n.td,{children:"Higher cost (10+ FTS queries)"}),(0,t.jsx)(n.td,{children:"Lower cost (1 FTS query)"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"when-to-use-everything",children:"When to use $everything"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Patient portals (complete record)"}),"\n",(0,t.jsx)(n.li,{children:"Data export"}),"\n",(0,t.jsx)(n.li,{children:"Clinical summaries"}),"\n",(0,t.jsx)(n.li,{children:"Complete patient context"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"when-to-use-_revinclude",children:"When to use _revinclude"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Specific queries (e.g., "patients with their observations")'}),"\n",(0,t.jsx)(n.li,{children:"Better performance"}),"\n",(0,t.jsx)(n.li,{children:"Targeted data retrieval"}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var r=i(6540);const t={},s=r.createContext(t);function l(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);