"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6415],{6676:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>o,frontMatter:()=>d,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"Overview/FTS Index","title":"Indexing Strategy","description":"Efficient search is the heart of any FHIR server.","source":"@site/docs/Overview/FTS Index.md","sourceDirName":"Overview","slug":"/Overview/FTS Index","permalink":"/couchbase-fhir-ce-docs/docs/Overview/FTS Index","draft":false,"unlisted":false,"editUrl":"https://github.com/couchbaselabs/couchbase-fhir-ce-docs/tree/master/docs/Overview/FTS Index.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Indexing Strategy","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"FHIR Resources on Couchbase","permalink":"/couchbase-fhir-ce-docs/docs/Overview/FHIR Resources"},"next":{"title":"Couchbase Docker","permalink":"/couchbase-fhir-ce-docs/docs/Install Couchbase/Couchbase - Docker"}}');var i=s(4848),t=s(8453);const d={title:"Indexing Strategy",sidebar_position:4},l="Indexing Strategy",c={},h=[{value:"FTS-First Search",id:"fts-first-search",level:2},{value:"KV + FTS Hybrid Flow",id:"kv--fts-hybrid-flow",level:2},{value:"KV-Only Pagination",id:"kv-only-pagination",level:3},{value:"Example FTS Query",id:"example-fts-query",level:2},{value:"FTS Capabilities Used",id:"fts-capabilities-used",level:3},{value:"Under the Hood",id:"under-the-hood",level:2},{value:"Why FTS over GSI / SQL",id:"why-fts-over-gsi--sql",level:3},{value:"Summary",id:"summary",level:2}];function a(e){const n={blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"indexing-strategy",children:"Indexing Strategy"})}),"\n",(0,i.jsx)(n.p,{children:"Efficient search is the heart of any FHIR server."}),"\n",(0,i.jsxs)(n.p,{children:["Couchbase FHIR CE uses ",(0,i.jsx)(n.strong,{children:"Full Text Search (FTS)"})," as the ",(0,i.jsx)(n.strong,{children:"primary search engine"}),"\u2014backed by ",(0,i.jsx)(n.strong,{children:"Key-Value (KV)"})," lookups for lightning-fast retrieval."]}),"\n",(0,i.jsx)(n.p,{children:"This hybrid design enables:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sub-100 ms"})," search latency, even across millions of documents"]}),"\n",(0,i.jsxs)(n.li,{children:["Full support for ",(0,i.jsx)(n.strong,{children:"FHIR search parameters"})," (string, token, date, reference, number)"]}),"\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.strong,{children:"single source of truth"})," \u2014 indexes reference the same JSON you store"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"fts-first-search",children:"FTS-First Search"}),"\n",(0,i.jsxs)(n.p,{children:["Each collection (e.g. ",(0,i.jsx)(n.code,{children:"Patient"}),", ",(0,i.jsx)(n.code,{children:"Observation"}),", ",(0,i.jsx)(n.code,{children:"General"}),") has a dedicated ",(0,i.jsx)(n.strong,{children:"FTS index"})," tuned for its resource type."]}),"\n",(0,i.jsx)(n.p,{children:"FTS supports complex queries:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Text"}),": match, prefix, fuzzy, phrase"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Token"}),": system|code, coding arrays"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Date"}),": range, prefix, equality"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Number"}),": comparison and ranges"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reference"}),": ",(0,i.jsx)(n.code,{children:"subject.reference"}),", ",(0,i.jsx)(n.code,{children:"patient.reference"}),", etc."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Multi-field"})," conjunctive/disjunctive logic"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Example:",(0,i.jsx)(n.br,{}),"\n","Find active Observations for ",(0,i.jsx)(n.code,{children:"Patient/123"})," with ",(0,i.jsx)(n.code,{children:"code=loinc|1234-5"})," between two dates.",(0,i.jsx)(n.br,{}),"\n","All handled in a ",(0,i.jsx)(n.strong,{children:"single FTS query"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"kv--fts-hybrid-flow",children:"KV + FTS Hybrid Flow"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"FTS"})," executes the search \u2192 returns matching ",(0,i.jsx)(n.strong,{children:"document keys"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"KV"})," API fetches the full JSON docs by key in microseconds."]}),"\n",(0,i.jsxs)(n.li,{children:["Response is assembled into a ",(0,i.jsx)(n.strong,{children:"FHIR Bundle"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This separation lets FTS handle ",(0,i.jsx)(n.strong,{children:"query semantics"}),", while KV ensures ",(0,i.jsx)(n.strong,{children:"fast, consistent reads"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"kv-only-pagination",children:"KV-Only Pagination"}),"\n",(0,i.jsxs)(n.p,{children:["Subsequent pages can reuse the cached keyset \u2192 ",(0,i.jsx)(n.strong,{children:"no repeated FTS cost"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"example-fts-query",children:"Example FTS Query"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "query": {\n    "conjuncts": [\n      { "field": "resourceType", "match": "Patient" },\n      { "field": "name.given", "prefix": "john" },\n      { "field": "birthDate", "start": "1980-01-01", "end": "1990-12-31" }\n    ]\n  },\n  "size": 20,\n  "from": 0,\n  "sort": []\n}\n\nIndex: `tenant.Resources.ftsPatient`\n\nResult: list of matching document IDs \u2192 KV fetch \u2192 FHIR Bundle\n'})}),"\n",(0,i.jsx)(n.h3,{id:"fts-capabilities-used",children:"FTS Capabilities Used"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter Type"}),(0,i.jsx)(n.th,{children:"Common FHIR Fields"}),(0,i.jsx)(n.th,{children:"FTS Feature"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"name"}),", ",(0,i.jsx)(n.code,{children:"family"}),", ",(0,i.jsx)(n.code,{children:"given"}),", ",(0,i.jsx)(n.code,{children:"address"})]}),(0,i.jsx)(n.td,{children:"prefix, analyzers"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"token"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"identifier"}),", ",(0,i.jsx)(n.code,{children:"code"})," (system|code)"]}),(0,i.jsx)(n.td,{children:"exact token, keyword"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"date"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"effectiveDateTime"}),", ",(0,i.jsx)(n.code,{children:"birthDate"})]}),(0,i.jsx)(n.td,{children:"range"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"reference"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"subject.reference"}),", ",(0,i.jsx)(n.code,{children:"patient.reference"})]}),(0,i.jsx)(n.td,{children:"exact path match"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"valueQuantity.value"})}),(0,i.jsx)(n.td,{children:"numeric range"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"under-the-hood",children:"Under the Hood"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Per\u2011collection indexes"}),": ",(0,i.jsx)(n.code,{children:"ftsPatient"}),", ",(0,i.jsx)(n.code,{children:"ftsObservation"}),", ",(0,i.jsx)(n.code,{children:"ftsGeneral"})," tuned to resource shapes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Document type filter"}),": index only documents with ",(0,i.jsx)(n.code,{children:"resourceType"})," present and valid."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field mappings"}),": explicit mappings for all FHIR search parameters; dynamic mappings for nested arrays."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Analyzers"}),": keyword for tokens/codes, standard/lowercase for names and addresses; date/time parsing for temporal fields."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Partitions"}),": large collections use ",(0,i.jsx)(n.strong,{children:"partitioned FTS indexes"})," for linear scalability and higher parallelism."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"why-fts-over-gsi--sql",children:"Why FTS over GSI / SQL"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Feature"}),(0,i.jsx)(n.th,{children:"RDBMS / GSI"}),(0,i.jsx)(n.th,{children:"Couchbase FTS"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"JSON handling"}),(0,i.jsx)(n.td,{children:"Flattened columns"}),(0,i.jsx)(n.td,{children:"Native JSON paths"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Multi\u2011valued arrays"}),(0,i.jsx)(n.td,{children:"Complex joins"}),(0,i.jsx)(n.td,{children:"Built\u2011in array indexing"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Full\u2011text"}),(0,i.jsx)(n.td,{children:"Limited / none"}),(0,i.jsx)(n.td,{children:"Rich analyzers, stemming, fuzzy"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Search parameters"}),(0,i.jsx)(n.td,{children:"Manual mapping"}),(0,i.jsx)(n.td,{children:"Direct field mapping"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Performance"}),(0,i.jsx)(n.td,{children:"Heavy joins"}),(0,i.jsx)(n.td,{children:"O(1) KV fetch + parallel FTS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Consistency"}),(0,i.jsx)(n.td,{children:"Dual representations"}),(0,i.jsx)(n.td,{children:"Single JSON source"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Traditional RDBMS FHIR servers store JSON in a column and project search terms into relational indexes \u2014 creating duplication and synchronization overhead. Couchbase FHIR CE indexes ",(0,i.jsx)(n.strong,{children:"directly on JSON"})," \u2192 no flattening, no loss of fidelity."]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"Couchbase FHIR CE\u2019s FTS\u2011first strategy delivers:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"FHIR\u2011compliant search semantics"}),"\n",(0,i.jsx)(n.li,{children:"High throughput and low latency via KV + FTS"}),"\n",(0,i.jsx)(n.li,{children:"Single\u2011source\u2011of\u2011truth indexing on canonical JSON"}),"\n",(0,i.jsx)(n.li,{children:"Scalable performance with partitioned indexes"}),"\n",(0,i.jsx)(n.li,{children:"Rich query semantics beyond SQL/relational models"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"FTS handles discovery; KV handles retrieval \u2014 together enabling fast, accurate, and scalable FHIR search."})]})}function o(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function d(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);