"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[671],{8228:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"API/delete","title":"DELETE Resource","description":"Use DELETE to remove the current version of a resource while preserving its history.","source":"@site/docs/API/delete.mdx","sourceDirName":"API","slug":"/API/delete","permalink":"/docs/API/delete","draft":false,"unlisted":false,"editUrl":"https://github.com/couchbaselabs/couchbase-fhir-ce-docs/tree/master/docs/API/delete.mdx","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"DELETE Resource"},"sidebar":"tutorialSidebar","previous":{"title":"Conditional Updates","permalink":"/docs/API/conditional"},"next":{"title":"Bundle Processing","permalink":"/docs/API/bundle"}}');var i=t(4848),o=t(8453);const r={sidebar_position:8,title:"DELETE Resource"},a="DELETE \u2014 Soft Delete",l={},c=[{value:"Effect:",id:"effect",level:3},{value:"Example",id:"example",level:2},{value:"First, lets get the doc to make sure",id:"first-lets-get-the-doc-to-make-sure",level:3},{value:"Lets delete",id:"lets-delete",level:3},{value:"Lets try and get back Patient/100",id:"lets-try-and-get-back-patient100",level:3},{value:"From CB Console, lets first check out this Patient:",id:"from-cb-console-lets-first-check-out-this-patient",level:3},{value:"In Patient Collection:",id:"in-patient-collection",level:4},{value:"In Versions Collection:",id:"in-versions-collection",level:4},{value:"In Tombstones Collection",id:"in-tombstones-collection",level:4},{value:"Lets try and now PUT a Patient with the same id",id:"lets-try-and-now-put-a-patient-with-the-same-id",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"delete--soft-delete",children:"DELETE \u2014 Soft Delete"})}),"\n",(0,i.jsx)(n.p,{children:"Use DELETE to remove the current version of a resource while preserving its history.\nCouchbase FHIR CE performs a soft delete:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The active document is removed from its resource collection (e.g., Resources.Patient)."}),"\n",(0,i.jsx)(n.li,{children:"The most recent active state is already in Resources.Versions (from prior PUT/PATCH)."}),"\n",(0,i.jsxs)(n.li,{children:["A tombstone is written to Resources.Tombstones with:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"resourceType, id"}),"\n",(0,i.jsx)(n.li,{children:"lastVersionId"}),"\n",(0,i.jsx)(n.li,{children:"deletedAt, deletedBy"}),"\n",(0,i.jsx)(n.li,{children:"reason"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"effect",children:"Effect:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Normal READ (GET /\u2026/Patient/100) no longer returns the resource."}),"\n",(0,i.jsx)(n.li,{children:"History (_history) remains available."}),"\n",(0,i.jsx)(n.li,{children:"Resource is excluded from search results."}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Beta Note",type:"info",children:(0,i.jsx)(n.p,{children:"Hard purge (cascading, permanent delete) is not implemented."})}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.p,{children:"Lets go through this, step by step"}),"\n",(0,i.jsx)(n.h3,{id:"first-lets-get-the-doc-to-make-sure",children:"First, lets get the doc to make sure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'curl \'http://localhost/fhir/acme/Patient/100\'\n{"resourceType":"Patient","id":"100","meta":{"versionId":"2","lastUpdated":"2025-10-09T17:51:51.025+00:00","tag":[{"system":"http://couchbase.fhir.com/fhir/custom-tags","code":"updated-by","display":"user:anonymous"}]},"name":[{"use":"official","family":"Doe","given":["John"]}],"gender":"male","birthDate":"1990-01-01","deceasedDateTime":"2022-07-22"}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"lets-delete",children:"Lets delete"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:"curl --request DELETE 'http://localhost/fhir/acme/Patient/100' \\\n--data ''\n"})}),"\n",(0,i.jsx)(n.h3,{id:"lets-try-and-get-back-patient100",children:"Lets try and get back Patient/100"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'curl \'http://localhost/fhir/acme/Patient/100\'\n\n{"resourceType":"OperationOutcome","issue":[{"severity":"error","code":"processing","diagnostics":"HAPI-0389: Failed to call access method: java.lang.RuntimeException: com.couchbase.client.core.error.DocumentNotFoundException: Document with the given id not found {\\"completed\\":true,\\"coreId\\":\\"0x3ff292c800000001\\",\\"idempotent\\":true,\\"lastChannelId\\":\\"3FF292C800000001/00000000E47D4954\\",\\"lastDispatchedFrom\\":\\"172.19.0.2:49880\\",\\"lastDispatchedTo\\":\\"host.docker.internal:11210\\",\\"requestId\\":16705,\\"requestType\\":\\"GetRequest\\",\\"retried\\":0,\\"service\\":{\\"bucket\\":\\"acme\\",\\"collection\\":\\"Patient\\",\\"documentId\\":\\"Patient/100\\",\\"errorCode\\":{\\"description\\":\\"Not Found\\",\\"name\\":\\"KEY_ENOENT\\"},\\"opaque\\":\\"0x3d3a\\",\\"scope\\":\\"Resources\\",\\"type\\":\\"kv\\",\\"vbucket\\":178},\\"status\\":\\"NOT_FOUND\\",\\"timeoutMs\\":10000,\\"timings\\":{\\"dispatchMicros\\":1656,\\"totalDispatchMicros\\":1656,\\"totalServerMicros\\":0,\\"totalMicros\\":2207,\\"serverMicros\\":0}}"}]}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"from-cb-console-lets-first-check-out-this-patient",children:"From CB Console, lets first check out this Patient:"}),"\n",(0,i.jsx)(n.h4,{id:"in-patient-collection",children:"In Patient Collection:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'select * from acme.Resources.Patient where resourceType = "Patient" and id = "100" ;\n\nResult: Empty\n'})}),"\n",(0,i.jsx)(n.h4,{id:"in-versions-collection",children:"In Versions Collection:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'select * from acme.Resources.Versions where resourceType = "Patient" and id = "100" ;\n'})}),"\n",(0,i.jsx)(n.p,{children:"Result: 2 Versions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "Versions": {\n      "birthDate": "1990-01-01",\n      "deceasedDateTime": "2022-07-22",\n      "gender": "male",\n      "id": "100",\n      "meta": {\n        "lastUpdated": "2025-10-09T17:51:51.025+00:00",\n        "tag": [\n          {\n            "code": "updated-by",\n            "display": "user:anonymous",\n            "system": "http://couchbase.fhir.com/fhir/custom-tags"\n          }\n        ],\n        "versionId": "2"\n      },\n      "name": [\n        {\n          "family": "Doe",\n          "given": ["John"],\n          "use": "official"\n        }\n      ],\n      "resourceType": "Patient"\n    }\n  },\n  {\n    "Versions": {\n      "birthDate": "1990-01-01",\n      "gender": "male",\n      "id": "100",\n      "meta": {\n        "lastUpdated": "2025-10-09T17:41:14.645+00:00",\n        "tag": [\n          {\n            "code": "created-by",\n            "display": "user:anonymous",\n            "system": "http://couchbase.fhir.com/fhir/custom-tags"\n          }\n        ],\n        "versionId": "1"\n      },\n      "name": [\n        {\n          "family": "Doe",\n          "given": ["John"],\n          "use": "official"\n        }\n      ],\n      "resourceType": "Patient"\n    }\n  }\n]\n'})}),"\n",(0,i.jsx)(n.h4,{id:"in-tombstones-collection",children:"In Tombstones Collection"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'select * from acme.Resources.Tombstones where resourceType = "Patient" and id = "100" ;\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "Tombstones": {\n      "deletedAt": "2025-10-09T18:10:05.143378822Z",\n      "deletedBy": "user:anonymous",\n      "id": "100",\n      "lastVersionId": "2",\n      "reason": "user-request",\n      "resourceType": "Patient",\n      "restorable": true\n    }\n  }\n]\n'})}),"\n",(0,i.jsx)(n.h3,{id:"lets-try-and-now-put-a-patient-with-the-same-id",children:"Lets try and now PUT a Patient with the same id"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'curl --request PUT \'http://localhost/fhir/acme/Patient/100\' \\\n--header \'Content-Type: application/json\' \\\n--data \'{\n  "resourceType": "Patient",\n  "id": "100",\n  "name": [\n    {\n      "use": "official",\n      "family": "Doe",\n      "given": ["Jane"]\n    }\n  ],\n  "gender": "female",\n  "birthDate": "1990-01-01"\n}\'\n\n{"resourceType":"OperationOutcome","issue":[{"severity":"error","code":"processing","diagnostics":"Failed to update resource: PUT operation failed: Transaction has failed with cause \'ca.uhn.fhir.rest.server.exceptions.ResourceVersionConflictException: Resource ID 100 was previously deleted and cannot be reused. Please choose a new ID.\'"}]}%\n'})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"DELETE performs a soft delete: removes active doc, preserves versions, writes a tombstone."}),"\n",(0,i.jsx)(n.li,{children:"Reads fail; history remains."}),"\n",(0,i.jsx)(n.li,{children:"Search excludes deleted resources."}),"\n",(0,i.jsx)(n.li,{children:"ID re-use is blocked by policy (beta)."}),"\n",(0,i.jsx)(n.li,{children:"Hard purge not yet supported."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(6540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);