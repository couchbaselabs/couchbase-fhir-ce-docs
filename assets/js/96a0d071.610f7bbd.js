"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2181],{4946:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"Install Couchbase FHIR Server/Enable TLS","title":"Enable TLS/HTTPS","description":"This guide shows how to enable HTTPS for Couchbase FHIR CE, using a real domain and certificates. It also clarifies that TLS for the FHIR web/API traffic is different from TLS used by the Couchbase SDK when connecting to Couchbase (e.g., Capella).","source":"@site/docs/Install Couchbase FHIR Server/Enable TLS.md","sourceDirName":"Install Couchbase FHIR Server","slug":"/Install Couchbase FHIR Server/Enable TLS","permalink":"/docs/Install Couchbase FHIR Server/Enable TLS","draft":false,"unlisted":false,"editUrl":"https://github.com/couchbaselabs/couchbase-fhir-ce-docs/tree/master/docs/Install Couchbase FHIR Server/Enable TLS.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Enable TLS/HTTPS"},"sidebar":"tutorialSidebar","previous":{"title":"Install FHIR Server","permalink":"/docs/Install Couchbase FHIR Server/Install FHIR Server"},"next":{"title":"Initialize","permalink":"/docs/Admin UI/Admin - Initial"}}');var s=i(4848),t=i(8453);const c={sidebar_position:4,title:"Enable TLS/HTTPS"},a="Enable TLS/HTTPS",o={},l=[{value:"Before You Start",id:"before-you-start",level:2},{value:"Where TLS Is Applied",id:"where-tls-is-applied",level:2},{value:"Configure HTTPS (Example: Cloudflare + Let&#39;s Encrypt)",id:"configure-https-example-cloudflare--lets-encrypt",level:2},{value:"Certificate Path Mapping",id:"certificate-path-mapping",level:2},{value:"Add TLS Later (No Redeploy)",id:"add-tls-later-no-redeploy",level:2},{value:"Update Your Base URL",id:"update-your-base-url",level:2},{value:"Verify HTTPS",id:"verify-https",level:2},{value:"Couchbase TLS (Capella)",id:"couchbase-tls-capella",level:2},{value:"Renewals",id:"renewals",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"enable-tlshttps",children:"Enable TLS/HTTPS"})}),"\n",(0,s.jsx)(n.p,{children:"This guide shows how to enable HTTPS for Couchbase FHIR CE, using a real domain and certificates. It also clarifies that TLS for the FHIR web/API traffic is different from TLS used by the Couchbase SDK when connecting to Couchbase (e.g., Capella)."}),"\n",(0,s.jsx)(n.h2,{id:"before-you-start",children:"Before You Start"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["You have a domain (e.g., ",(0,s.jsx)(n.code,{children:"cbfhir.com"}),")."]}),"\n",(0,s.jsx)(n.li,{children:"Your DNS points to the host running Couchbase FHIR CE. If you use Cloudflare, DNS setup is outside the scope of this page."}),"\n",(0,s.jsx)(n.li,{children:"You can obtain valid server certificates (e.g., via Let's Encrypt)."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"where-tls-is-applied",children:"Where TLS Is Applied"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["HTTPS for end users terminates at HAProxy (the load balancer in ",(0,s.jsx)(n.code,{children:"couchbase-fhir-ce"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Couchbase SDK TLS (to Couchbase/Capella) is separate and configured via connection settings in ",(0,s.jsx)(n.code,{children:"config.yaml"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configure-https-example-cloudflare--lets-encrypt",children:"Configure HTTPS (Example: Cloudflare + Let's Encrypt)"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Obtain a certificate for your domain (e.g., ",(0,s.jsx)(n.code,{children:"cbfhir.com"}),") via Let's Encrypt (or your CA)."]}),"\n",(0,s.jsxs)(n.li,{children:["Place the certificate and private key files on the host machine (e.g., under ",(0,s.jsx)(n.code,{children:"couchbase-fhir-ce/certs/"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Edit ",(0,s.jsx)(n.code,{children:"couchbase-fhir-ce/config.yaml"})," and update the TLS section to reference your certificate files and enable HTTPS. Also update ",(0,s.jsx)(n.code,{children:"baseUrl"})," to use ",(0,s.jsx)(n.code,{children:"https://<your-domain>/fhir"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Apply the configuration and restart services."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Apply TLS configuration"',children:'cd couchbase-fhir-ce\n# Edit your config\nnano config.yaml\n\nExample:\n----------------------------------------------------------------\napp:\n  baseUrl: "https://cbfhir.com/fhir"\n  autoConnect: true\n\ncouchbase:\n  connection:\n    connectionString: "ec2-54-69-205-100.us-west-2.compute.amazonaws.com"\n    username: "Administrator"\n    password: "P@ssw0rd"\n    serverType: "Server" # [Server, Capella]\n    sslEnabled: false # [true, false]\n\n  bucket:\n    name: "fhir" # Fixed\n    fhirRelease: "R4" # Fixed\n    validation:\n      mode: "lenient"     # [lenient, none]\n      profile: "us-core"  # [us-core, none]\n\n  sdk:\n    overrides: {}\n\nadmin:\n  email: "admin@cbfhir.com"\n  password: "Admin123!"\n  name: "Admin"\n\ndeploy:\n  container:\n    mem_limit: "20g"\n    mem_reservation: "16g"\n\n  jvm:\n    xms: "12g"\n    xmx: "12g"\n\n  environment:\n    overrides: {}\n\n  tls:\n    enabled: true\n    # For HAProxy: single PEM containing fullchain + privkey\n    pemPath: "./certs/cbfhir.com.pem"\n\nlogging:\n  default: "ERROR"\n  overrides:\n  # overrides. Complete list of availabe overrides in docs\n  com.couchbase.admin.config.service.ConfigurationStartupService: "INFO"\n  com.couchbase.fhir.config.TomcatConfigLogger: "WARN"\n  com.couchbase.fhir.config.VirtualThreadConfig: "WARN"\n--------------------------------------------------------\n\n# Re-generate docker-compose.yml and haproxy.cfg\n./scripts/apply-config.sh ./config.yaml\n# Restart to apply\ndocker compose restart\n'})}),"\n",(0,s.jsx)(n.admonition,{title:"Do Not Edit Generated Files",type:"warning",children:(0,s.jsxs)(n.p,{children:["Do not manually edit ",(0,s.jsx)(n.code,{children:"docker-compose.yml"})," or ",(0,s.jsx)(n.code,{children:"haproxy.cfg"}),". They are generated from ",(0,s.jsx)(n.code,{children:"config.yaml"})," and will be overwritten when you re-apply configuration."]})}),"\n",(0,s.jsx)(n.h2,{id:"certificate-path-mapping",children:"Certificate Path Mapping"}),"\n",(0,s.jsxs)(n.p,{children:["When you set ",(0,s.jsx)(n.code,{children:"deploy.tls.pemPath"})," to a host file (e.g., ",(0,s.jsx)(n.code,{children:"./certs/cbfhir.com.pem"}),"), the installer maps it into the HAProxy container with a standardized name:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Host: ",(0,s.jsx)(n.code,{children:"./certs/cbfhir.com.pem"})," (your actual certificate file)"]}),"\n",(0,s.jsxs)(n.li,{children:["Container: ",(0,s.jsx)(n.code,{children:"/etc/haproxy/certs/server.pem"})," (standardized name inside container)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This keeps your original filename on the host, and ensures HAProxy always references a consistent path: ",(0,s.jsx)(n.code,{children:"/etc/haproxy/certs/server.pem"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"add-tls-later-no-redeploy",children:"Add TLS Later (No Redeploy)"}),"\n",(0,s.jsx)(n.p,{children:"You can enable TLS after an initial non-TLS install without redeploying:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Enable TLS after install"',children:'cd couchbase-fhir-ce\n\n# Edit config.yaml in the installation folder\nnano config.yaml\n\n# Example changes\n#\n# deploy:\n#   tls:\n#     enabled: true\n#     pemPath: "./certs/cbfhir.com.pem"\n# app:\n#   baseUrl: "https://cbfhir.com/fhir"\n\n# Apply config and restart services\n./scripts/apply-config.sh ./config.yaml\ndocker compose restart\n'})}),"\n",(0,s.jsxs)(n.p,{children:["What ",(0,s.jsx)(n.code,{children:"apply-config.sh"})," does:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Reads the local ",(0,s.jsx)(n.code,{children:"config.yaml"})," in ",(0,s.jsx)(n.code,{children:"couchbase-fhir-ce"})]}),"\n",(0,s.jsxs)(n.li,{children:["Regenerates ",(0,s.jsx)(n.code,{children:"docker-compose.yml"})," and ",(0,s.jsx)(n.code,{children:"haproxy.cfg"})," (including TLS settings)"]}),"\n",(0,s.jsx)(n.li,{children:"Restarts services to apply the new configuration"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"update-your-base-url",children:"Update Your Base URL"}),"\n",(0,s.jsxs)(n.p,{children:["When enabling HTTPS, ensure ",(0,s.jsx)(n.code,{children:"baseUrl"})," reflects the public HTTPS endpoint, typically:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"https://cbfhir.com/fhir"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This value is used by the server to construct absolute links and should match your public URL."}),"\n",(0,s.jsx)(n.h2,{id:"verify-https",children:"Verify HTTPS"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Quick checks"',children:"# Expect HTTP->HTTPS redirect or direct 200\ncurl -I https://cbfhir.com\n\n# Check the FHIR base path\ncurl -I https://cbfhir.com/fhir/metadata\n\n# Inspect certificate chain\nopenssl s_client -connect cbfhir.com:443 -servername cbfhir.com </dev/null | sed -n '1,20p'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"couchbase-tls-capella",children:"Couchbase TLS (Capella)"}),"\n",(0,s.jsxs)(n.p,{children:["If you connect to Couchbase Capella, TLS is built-in on the database side. Configure SDK/connection TLS independently in ",(0,s.jsx)(n.code,{children:"config.yaml"})," (this uses different certificates/settings than your HTTPS certificate). The HTTPS certificate for HAProxy does not affect SDK connections."]}),"\n",(0,s.jsx)(n.h2,{id:"renewals",children:"Renewals"}),"\n",(0,s.jsx)(n.p,{children:"When certificates are renewed, update the files on the host, then re-run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd couchbase-fhir-ce\n./scripts/apply-config.sh ./config.yaml\ndocker compose restart\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>a});var r=i(6540);const s={},t=r.createContext(s);function c(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);