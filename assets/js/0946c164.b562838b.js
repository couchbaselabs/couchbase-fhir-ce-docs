"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7986],{7868:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"API/conditional","title":"Conditional Updates","description":"Conditional Updates apply to PUT, PATCH and DELETE operations.","source":"@site/docs/API/conditional.mdx","sourceDirName":"API","slug":"/API/conditional","permalink":"/docs/API/conditional","draft":false,"unlisted":false,"editUrl":"https://github.com/couchbaselabs/couchbase-fhir-ce-docs/tree/master/docs/API/conditional.mdx","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"Conditional Updates"},"sidebar":"tutorialSidebar","previous":{"title":"Checkpoint after updates","permalink":"/docs/API/check"},"next":{"title":"DELETE Resource","permalink":"/docs/API/delete"}}');var s=t(4848),r=t(8453);const a={sidebar_position:7,title:"Conditional Updates"},d="Conditional PUT",o={},l=[{value:"Method",id:"method",level:2},{value:"Operation",id:"operation",level:2},{value:"Behavior (FHIR R4)",id:"behavior-fhir-r4",level:2},{value:"Best practice: use a unique key",id:"best-practice-use-a-unique-key",level:3},{value:"Quick comparison",id:"quick-comparison",level:2},{value:"Notes and reminders",id:"notes-and-reminders",level:2}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"conditional-put",children:"Conditional PUT"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"Conditional Updates apply to PUT, PATCH and DELETE operations."})}),"\n",(0,s.jsx)(n.p,{children:"Lets create a Patient"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'curl --request PUT \'http://localhost/fhir/acme/Patient/100\' \\\n--header \'Content-Type: application/json\' \\\n--data \'{\n  "resourceType": "Patient",\n  "id": "100",\n  "name": [\n    {\n      "use": "official",\n      "family": "Doe",\n      "given": ["John"]\n    }\n  ],\n  "gender": "male",\n  "birthDate": "1990-01-01"\n}\'\n\nResponse:\n\n{"resourceType":"Patient","id":"100","meta":{"versionId":"1","lastUpdated":"2025-10-09T17:41:14.645+00:00","tag":[{"system":"http://couchbase.fhir.com/fhir/custom-tags","code":"created-by","display":"user:anonymous"}]},"name":[{"use":"official","family":"Doe","given":["John"]}],"gender":"male","birthDate":"1990-01-01"}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Lets add deceasedDateTime, but this time, lets say we do not know the id but search for name."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'curl --request PUT \'http://localhost/fhir/acme/Patient?name=Doe\' \\\n--header \'Content-Type: application/json\' \\\n--data \'{\n  "resourceType": "Patient",\n  "name": [\n    {\n      "use": "official",\n      "family": "Doe",\n      "given": ["John"]\n    }\n  ],\n  "gender": "male",\n  "birthDate": "1990-01-01",\n  "deceasedDateTime": "2022-07-22"\n}\'\n\nResponse:\n\n{"resourceType":"Patient","id":"100","meta":{"versionId":"2","lastUpdated":"2025-10-09T17:51:51.025+00:00","tag":[{"system":"http://couchbase.fhir.com/fhir/custom-tags","code":"updated-by","display":"user:anonymous"}]},"name":[{"use":"official","family":"Doe","given":["John"]}],"gender":"male","birthDate":"1990-01-01","deceasedDateTime":"2022-07-22"}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"method",children:"Method"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'If a single Patient matches (family="Doe"), the server will update that resource and replace all fields with those provided in your body.'}),"\n",(0,s.jsx)(n.li,{children:"If no Patient matches, a new resource is created with server-assigned ID."}),"\n",(0,s.jsx)(n.li,{children:"If multiple matches exist, the server returns an error due to ambiguity."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"operation",children:"Operation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'The server will search for a Patient with the name "Doe".'}),"\n",(0,s.jsx)(n.li,{children:"If one exists, it will be fully replaced by this content."}),"\n",(0,s.jsx)(n.li,{children:"If none exists, a new Patient is created and assigned a new server-generated id."}),"\n",(0,s.jsx)(n.li,{children:"If multiple match, the server will reject with an error due to ambiguity."}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsx)(n.p,{children:"For this usage, it's best to ensure your search criteria are unique enough to avoid multiple matches."})}),"\n",(0,s.jsx)(n.h2,{id:"behavior-fhir-r4",children:"Behavior (FHIR R4)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Exactly 1 match \u2192 the matched resource is fully replaced by the request body.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"HTTP 200 OK"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["0 matches \u2192 a new resource is created with a server-assigned id.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"HTTP 201 Created"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:">"})," 1 matches \u2192 ambiguous; the server must reject the operation.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"HTTP 412 Precondition Failed"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": On conditional PUT, any id inside the body is ignored. The target id is determined by the match (or by creation if no match)."]}),"\n",(0,s.jsx)(n.h3,{id:"best-practice-use-a-unique-key",children:"Best practice: use a unique key"}),"\n",(0,s.jsx)(n.p,{children:"Using name can be ambiguous. Prefer a unique identifier:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"PUT /fhir/<bucket>/Patient?identifier=http://hospital.smarthealthit.org|1032702\n"})}),"\n",(0,s.jsx)(n.h2,{id:"quick-comparison",children:"Quick comparison"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Operation"}),(0,s.jsx)(n.th,{children:"0 matches"}),(0,s.jsx)(n.th,{children:"1 match"}),(0,s.jsx)(n.th,{children:">1 matches"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Conditional PUT"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"201 Created"})," (new id)"]}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"200 OK"})," (replace)"]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"412 Precondition Failed"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Conditional PATCH"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"404 Not Found"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"200 OK"})," (patch)"]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"412 Precondition Failed"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"notes-and-reminders",children:"Notes and reminders"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PUT replaces the entire resource. Fields not present in the body are removed. Use PATCH for partial changes."}),"\n",(0,s.jsx)(n.li,{children:"On success, the server updates meta.lastUpdated, increments meta.versionId, and sets audit tags (created-by / updated-by)."}),"\n",(0,s.jsx)(n.li,{children:"If your bucket enforces US Core, the server may set meta.profile accordingly and apply profile validation (Strict / Lenient / Disabled)."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>d});var i=t(6540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);